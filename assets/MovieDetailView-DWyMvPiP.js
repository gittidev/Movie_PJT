import{_ as E}from"./empty_popcorn_box2-DXq9_Pa-.js";import{_ as N,r as c,j as O,z as V,o as a,c as l,a as e,t as r,l as $,q as k,p as P,g as L,x as J,h as Y,J as A,i as z,v as Z,F as M,n as x,m as F,d as C,w as Q,u as W,b as D,R as G}from"./index-BZNf6Ntn.js";import{C as q}from"./CommunityCreate-B29AeLmC.js";var H={VITE_APP_TMDB_KEY:"991d06942ce406b58a82857c3d0ead84",VITE_APP_TMDB_TOKEN:"eyJhbGciOiJIUzI1NiJ9.eyJhdWQiOiI5OTFkMDY5NDJjZTQwNmI1OGE4Mjg1N2MzZDBlYWQ4NCIsInN1YiI6IjY2Mjc2MmMxMjljNjI2MDE3ZTRhMzZkNiIsInNjb3BlcyI6WyJhcGlfcmVhZCJdLCJ2ZXJzaW9uIjoxfQ.g4r5KKYcqQgtDvdke4OcSijnCKGyEMxKDIXNfKnNnWc",BASE_URL:"/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const X=n=>(P("data-v-c3ec78cd"),n=n(),L(),n),ee={class:"trailer-title"},te={class:"trailer-handler"},se={key:0,class:"spinner-border text-primary",role:"status"},oe=X(()=>e("span",{class:"visually-hidden"},"Loading...",-1)),ae=[oe],ie=["src"],le={__name:"YoutubeTrailer",props:{movie:Object},setup(n){const m=n,v=c(""),u=c(!1),p=H.VITE_YOUTUBE_API_KEY,y=async()=>{u.value=!0;const _="https://www.googleapis.com/youtube/v3/search";try{const i=await k.get(_,{params:{key:p,part:"snippet",type:"video",q:`${m.movie.original_title} 공식 예고편`,maxResults:1}});if(i.data.items.length>0){const t=i.data.items[0].id.videoId;v.value=`https://www.youtube.com/embed/${t}?autoplay=0&mute=1`}else console.error("No videos found")}catch(i){console.error("서버에러:",i)}finally{u.value=!1}};return O(()=>{y()}),V(()=>m.movie.original_title,_=>{_&&y()}),(_,i)=>(a(),l("div",null,[e("div",ee,r(n.movie.title)+" 공식 예고편",1),e("div",te,[u.value?(a(),l("div",se,ae)):v.value?(a(),l("iframe",{key:1,class:"trailer-iframe",src:v.value,frameborder:"0",allowfullscreen:"",sandbox:"allow-same-origin allow-scripts allow-presentation"},null,8,ie)):$("",!0)])]))}},ne=N(le,[["__scopeId","data-v-c3ec78cd"]]),g=n=>(P("data-v-4033ea2d"),n=n(),L(),n),re={key:0,style:{display:"flex","align-items":"center","justify-content":"center"}},ce=g(()=>e("img",{src:E,alt:"",style:{width:"50%",display:"block"}},null,-1)),ue=g(()=>e("h2",{style:{"font-family":"'LOTTERIACHAB'",display:"block"}},"로딩 중...",-1)),de=[ce,ue],ve={key:1},_e={class:"container",style:{margin:"auto","margin-top":"4rem"}},me={class:"row"},pe={class:"col-6"},he=["src"],ge={class:"col-6"},ye={class:"row"},fe={class:"col-6"},ke={class:"col"},we={class:"row"},be={class:"col-5"},Ie={class:"col"},Te={class:"col-12",style:{"margin-top":"30px"}},Me=g(()=>e("div",{style:{"font-family":"'KCC-Hanbit"}},[e("h2",null,"POT 목록")],-1)),xe={key:0},Ce={class:"card",style:{"min-height":"50px",height:"auto",padding:"20px"}},De=["onClick"],Ee={key:1},Ne=g(()=>e("p",null,"현재 생성된 POT 이 없어요[좋아요를 누르면 해당영화의 POT을 생성할 수 있습니다]",-1)),Oe={class:"col-12",style:{"margin-bottom":"100px"}},$e=g(()=>e("div",{class:"footer"},[e("span",null,"ⓒ 2024. 광주2반 9팀"),e("span",null," 박보람, 박동민")],-1)),Pe="https://image.tmdb.org/t/p/w500",Le={__name:"MovieDetailView",setup(n){const m=c(!0),v=J(),u=Y(),p=A(),y=z(),_=Z(),i=c(0),t=c({}),j=c(u.token),f=c([]),R=function(s){_.push({name:"communitydetail",params:{communityId:s}})},h=c(!1),w=c(0),b=c([]),I=c("");i.value=y.params.movieId;const S=async s=>{try{await v.getMovieDetail(s),t.value=v.movieDetail;const o=`[${t.value.genres.map(d=>d.id).join(", ")}]`;await k({method:"post",url:`${v.API_URL}/marshmovie/db_check/${s}/`,headers:{Authorization:`Token ${j.value}`},data:{adult:t.value.adult,movie_id:t.value.id,title:t.value.title,backdrop_path:t.value.backdrop_path,genre_ids:o,overview:t.value.overview,poster_path:t.value.poster_path,release_date:t.value.release_date,original_title:t.value.original_title,vote_average:t.value.vote_average}}),m.value=!1,console.log("db추가완료")}catch{alert("로그인이 필요합니다.")}},T=async function(s){try{const o=await k({method:"get",url:`${u.API_URL}/marshmovie/movies/${s}/`});b.value=o.data,console.log(o.data,"좋아요한 영화 정보를 가져왔습니다."),w.value=o.data.like_users.length,h.value=o.data.like_users.some(d=>d===I.value),m.value=!1}catch(o){console.error("Error:",o.response?o.response.data:o.message)}},B=async function(){try{await p.getCommunities(),f.value=p.communities.filter(s=>s.movie===b.value.id)}catch(s){console.error("Error fetching communities:",s.response?s.response.data:s.message)}};O(async()=>{try{await S(i.value),await u.getUserInfo(),await T(i.value),await B(),u.token?I.value=u.state.user.pk:(alert("로그인이 필요합니다."),_.push({name:"login"}))}catch{alert("페이지 로딩 중 오류가 발생했습니다.")}}),f.value=p.communities.filter(function(s){return s.movie===i});const K=s=>s.poster_path?Pe+s.poster_path:E,U=async function(){const s=parseInt(i.value,10);if(u.token)try{await v.movieLikes(s),h.value=!h.value,await T(i.value)}catch(o){console.error("Error toggling movie like:",o.response?o.response.data:o.message),alert("좋아요를 반영하는 중 오류가 발생했습니다.")}else alert("로그인이 필요합니다")};return(s,o)=>(a(),l("div",null,[m.value?(a(),l("div",re,de)):(a(),l("div",ve,[e("div",null,[e("div",_e,[e("div",me,[e("div",pe,[e("img",{src:K(t.value),alt:"#",style:{width:"100%"}},null,8,he)]),e("div",ge,[e("h1",null,r(t.value.title),1),e("div",ye,[e("div",fe,[e("p",null,r(t.value.original_title),1),e("p",null,r(t.value.release_date),1),e("p",null,"평점 : "+r(t.value.vote_average),1),(a(!0),l(M,null,x(t.value.genres,d=>(a(),l("button",{class:"btn",style:{padding:"0rem 1rem",margin:"0.5rem","background-color":"#FF6363",height:"2rem"},key:d.id},r(d.name),1))),128))]),e("div",ke,[h.value?(a(),F(q,{key:0,class:"communitycreate"})):$("",!0)])]),e("p",null,r(t.value.overview),1),e("div",we,[e("div",be," 좋아요 수: "+r(w.value),1),e("div",Ie,[e("button",{class:"btn btn-warning",onClick:U},r(h.value?"좋아요 취소":"좋아요"),1)])])]),e("div",Te,[Me,f.value.length?(a(),l("div",xe,[(a(!0),l(M,null,x(f.value,d=>(a(),l("div",Ce,[e("div",null,[D("POT : "+r(d.title)+" ",1),e("button",{onClick:je=>R(d.id),class:"btn btn-primary",style:{"margin-left":"20px"}}," POT 참여하기 ",8,De)]),e("p",null,r(d.content),1)]))),256))])):(a(),l("div",Ee,[Ne,C(W(G),{to:{name:"community"},class:"btn btn-secondary"},{default:Q(()=>[D(" POT 생성하러 가기 ")]),_:1})]))]),e("div",Oe,[C(ne,{movie:t.value},null,8,["movie"])])])])])])),$e]))}},Ke=N(Le,[["__scopeId","data-v-4033ea2d"]]);export{Ke as default};
